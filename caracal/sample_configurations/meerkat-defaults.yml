schema_version: 0.3.0

general:
  msdir: msdir
  input: input
  output: output
  prefix: mypipelinerun
  init_pipeline: true


get_data:
  dataid: []

observation_config: 
  obsinfo: 
    enable: true
  target:
    - 'all'
  gcal: 
    - 'all'
  bpcal:
    - 'longest'
  fcal:
    - 'longest'
  xcal:
    - 'longest'
  reference_antenna: '0'

prepare_data: 
  enable: true
  fixvis: 
    enable: false
  manage_flags: 
    mode: restore
    version: caracal_legacy
  clear_cal: true
  spectral_weights:
    mode: uniform

flagging:
  enable: true
  field: calibrators
  label_in: ''
  flag_autocorr:
    enable: true
  flag_spw:
    enable: true
    channels: '*:856~880MHz , *:1658~1800MHz, *:1419.8~1421.3MHz'
    ensure_valid_selection: false
  flag_antennas:
    enable: false
    antennas: '0'
  flag_mask:
    enable: true
    mask: labelled_rfimask.pickle.npy
    uvrange: '0~1000'
  flag_rfi:
    enable: true
    flagger: aoflagger
    aoflagger:
      strategy: firstpass_QUV.rfis

cross_cal:
  enable: true
  otfdelay: true
  uvrange: '>150'
  label_in: ''
  label_cal: 1gc1
  load_flags:
    version: after_flagging_automatic
    merge: False
  set_model:
    enable: true
    caracal_model: true
  primary_cal:
    enable: true
    reuse_existing_gains: true
    order: KGBAKGB
    combine: ["", "", "", null, "","", scan]
    solint: [inf, inf, inf, null, 60s, 60s, inf]
    calmode: [a, ap, ap, null, a, ap, ap] 
    B_fillgaps: 70
    plotgains: true
  secondary_cal:
    enable: true
    reuse_existing_gains: true
    order: KGAKG
    apply: B
    combine: ["", "", null, "", ""] 
    solint: [inf, inf, null, inf, inf]
    calmode: [a, ap, null, a, ap] 
    plotgains: true
  apply_cal: 
    enable: true
    applyto: 
      - gcal
      - bpcal
      - target

polcal: 
  enable: false

inspect_data: 
  enable: true
  label_out: '1gc'
  fields:
    - bpcal
    - gcal
  real_imag: 
    enable: true
    avgtime: '60'
  amp_phase: 
    enable: true
    avgtime: '60'
  amp_uvwave: 
    enable: true
    avgtime: '60'
  amp_ant: 
    enable: true
    avgtime: '60'
  phase_uvwave: 
    enable: true
    avgtime: '60'
  amp_scan: 
    enable: true
    avgtime: '60'

transform_data: 
  enable: true
  label_in: ''
  label_out: corr
  split_field: 
    enable: true
    time_average: ''
    freq_average: 1
    column: corrected
    correlation: ''
    spw: ''
    otfcal: 
      enable: false
  obsinfo: 
    enable: true
    listobs: true

flagging__2: 
  enable: true
  field: target
  label_in: corr
  flag_rfi: 
    enable: true
    column: DATA
    flagger: aoflagger
    aoflagger:
      strategy: firstpass_QUV.rfis

masking: 
  enable: false
  centre_coord:
    - HH:MM:SS
    - DD:MM:SS
  label_in: corr

self_cal:
  enable: true
  img_npix: 4096
  img_cell: 1.3
  cal_timeslots_chunk: 240
  image:
    enable: true
  calibrate:
    enable: true
    Gsols_timeslots: [120]

direction_dependent_calibration:
  enable: false
  label: 'corr'
  use_pb: true
  calibrate_dd:
    enable: True
    sigma: 0.4
    de_sources_mode: manual
    de_sources_manual: ['14h15m26.0s,-65d57m16.5s,80']
    de_target_manual: ['circinus-p3']
  image_dd:
    deconv_maxminoriter: 10000
    freq_nband: 10
  copy_data:
    enable: true
  image_wsclean:
    enable: true
    img_ws_npix: 5000
  transfer_model_dd:
    enable: true

image_line:
  enable: true
  restfreq: '1.420405752GHz'
  make_cube:
    enable: true
    npix: [1800]
    cell: 2
  mstransform:
    enable: true
    doppler:
      enable: true
      telescope: meerkat
