schema_version: 0.3.0

general:
  msdir: msdir
  input: input
  output: output
  prefix: workflow2
  init_pipeline: true


get_data:
  dataid: []

observation_config:
  target:
    - 'all'
  fcal:
    - 'longest'
  bpcal:
    - 'longest'
  gcal:
    - 'all'
  xcal:
    - 'longest'
  reference_antenna: '0'
  
prepare_data: 
  enable: true
  fixvis: 
    enable: false
  manage_flags: 
    enable: true
  clear_cal: true
  spectral_weights:
    enable: true
    mode: uniform

transform_data:
  enable: true
  label_in: ''
  label_out: 'cal'
  split_field:
    enable: true
    field: 'calibrators'
    time_average: ''
    freq_average: 1
    column: data
    correlation: ''
    spw: ''
    otfcal:
      enable: false
  obsinfo:
    enable: true
    listobs: true

flagging:
  enable: true
  field: calibrators
  label_in: cal
  flag_autocorr:
    enable: true
  flag_spw:
    enable: true
    channels: '*:856~880MHz , *:1658~1800MHz, *:1419.8~1421.3MHz'
    ensure_valid_selection: false
  flag_antennas:
    enable: false
    antennas: '0'
  flag_scan:
    enable: false
    scans: '0'
  flag_mask:
    enable: true
    mask: labelled_rfimask.pickle.npy
    uvrange: '0~1000'
  flag_rfi:
    enable: true
    flagger: aoflagger
    aoflagger:
      strategy: firstpass_QUV.rfis
  inspect:
    enable: true
    telescope: MeerKAT
    field: 'bpcal,gcal'

cross_cal:
  enable: true
  uvrange: '>150'
  label_cal: 1gc1
  label_in: 'cal'
  set_model:
    enable: true
  primary_cal:
    enable: true
    reuse_existing_gains: true
    order: KGBAKGB
    combine: ["", "", "", null, "","", scan]
    solint: [inf, inf, inf, null, 60s, 60s, inf]
    calmode: [a, ap, ap, null, a, ap, ap] 
    B_fillgaps: 70
    plotgains: true
  secondary_cal:
    enable: true
    reuse_existing_gains: true
    order: KGAKG
    apply: B
    combine: ["", "", null, "", ""] 
    solint: [inf, inf, null, inf, inf]
    calmode: [a, ap, null, a, ap] 
    plotgains: true
  apply_cal: 
    enable: true
    applyto: 
      - gcal
      - bpcal

polcal: 
  enable: false

inspect_data: 
  enable: false
  label_in: 'cal'
  label_out: '1gc'
  fields:
    - bpcal
    - gcal
  real_imag: 
    enable: true
    avgtime: '60'
  amp_phase: 
    enable: true
    avgtime: '60'
  amp_uvwave: 
    enable: true
    avgtime: '60'
  amp_ant: 
    enable: true
    avgtime: '60'
  phase_uvwave: 
    enable: true
    avgtime: '60'
  amp_scan: 
    enable: true
    avgtime: '60'

transform_data__2:
  enable: true
  label_in: ''
  label_out: corr
  split_field: 
    enable: true
    field: 'target'
    time_average: ''
    freq_average: 1
    column: corrected
    correlation: ''
    spw: ''
    otfcal: 
      enable: true
#      callib: 'your_callib.txt'
      label_cal: '1gc1'
  obsinfo: 
    enable: true
    listobs: true

flagging__2: 
  enable: true
  field: target
  label_in: corr
  flag_rfi: 
    enable: true
    flagger: aoflagger
    column: DATA
    aoflagger:
      strategy: firstpass_QUV.rfis
  inspect: 
    enable: true
    field: target

masking: 
  enable: false
  centre_coord:
    - HH:MM:SS
    - DD:MM:SS
  label_in: corr

self_cal:
  enable: false
  img_npix: 4096
  img_cell: 1.3
  image:
    enable: true
  calibrate:
    enable: true
    Gsols_timeslots: [120]

image_line:
  enable: false
  restfreq: '1.420405752GHz'
  make_cube:
    enable: true
    npix: [1800]
    cell: 2
  mstransform:
    enable: true
    doppler:
      enable: true
      telescope: meerkat
