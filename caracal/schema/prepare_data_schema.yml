type: map
mapping:
  schema_version:
    type: str
    required: true

  prepare_data:
    desc: Prepare the data for calibration and imaging.
    type: map
    mapping:
      enable:
        desc: Executes the data preparation step.
        type: bool
        required: true
        example: 'False'
      label_in:
        type: str
        required: true
        desc: Label of measurement set to work on.
        example: ''
      field:
        desc: Fields to work on. Only used if 'label_in' is not empty.
        type: str
        enum: ['target', 'calibrators']
        required: False
        example: ''
      fixvis:
        desc: Fixes the UVW coordinates through the CASA task fixvis.
        type: map
        mapping:
          enable:
            desc: Enable execution of fixvis.
            type: bool
            required: false
            example: 'False'            
      clear_cal:
        desc: Clears out calibrated data and resets previous predicted model
        type: bool
        required: false
        example: 'False'            
      manage_flags:
        desc: Manage flags
        type: map
        mapping:
          enable: 
            desc: Enable this segment
            type: bool
            required: false
            example: 'True'
          mode: 
            desc: Manage flag mode. If "save_legacy_flags" save the current FLAG column as a "caracal_legacy" flag version (if that already exists, "overwrite_legacy_flags" below allows you to overwrite it, but think twice). If "restore" restore flags from the flag version specified by "version" below, and delete all flag versions created after that version.
            type: str
            required: false
            example: 'save_legacy_flags'
            enum: [save_legacy_flags, restore]
          version:
            desc: Flag version to restore. Note that all flag versions saved after this version will be deleted.
            type: str
            required: false
            example: 'caracal_legacy'
          overwrite_legacy_flags:
            desc: If "mode" above is "save_legacy_flags" but the "caracal_legacy" flag version already exists, allow Caracal to overwrite it. Think twice!
            type: bool
            required: false
            example: 'False'
      spectral_weights: 
        desc: How to initialize spectral weights
        type: map
        mapping: 
          enable: 
            desc: Enable this segment
            type: bool
            required: false
            example: 'False'
          mode:
            desc: "uniform: Set all weights to unity. estimate: Estimate spectral weights from frequency-dependent SEFD/Tsys/Noise values, Also see 'estimate' segment of this section. delete: Delete WEIGHT_SPECTRUM column if it exists."
            type: str
            enum: [uniform, estimate, delete]
            required: false
            example: 'uniform'
          estimate:
            desc: Estimate spectral weights from frequency-dependent SEFD/Tsys/Noise values
            type: map
            mapping:
              stats_data: 
                desc: "File with SEFD/Tsys/Noise data. If data is from MeerKAT telescope, you can specify 'use_package_meerkat_spec' to use package data."
                type: str
                example: 'use_package_meerkat_spec'
                required: false
              weight_columns:
                seq:
                  - type: str
                desc: column names
                required: false
                example: 'WEIGHT, WEIGHT_SPECTRUM'
              noise_columns:
                seq:
                  - type: str
                desc: column names for noise
                required: false
                example: 'SIGMA, SIGMA_SPECTRUM'
              write_to_ms:
                desc: write columns to file
                type: bool
                required: false
                example: 'True'
