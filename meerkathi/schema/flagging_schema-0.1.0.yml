type: map
mapping:
  schema_version:
    type: str
    required: true

  flagging:
    desc: Pre-calibration flagging of the data.
    type: map
    mapping:
      enable: 
        desc: Execute pre-calibration flagging of the data.
        type: bool
        required: true
      order:
        desc: Order in queue of workers. Generally a non-negative integer. 
        type: int
        required: true
      label:
        desc: The label is added to the input .MS file name to define the name of the .MS file that should be flagged, <input>-<label>.ms. Default is an empty string, i.e., the original .MS is flagged.
        type: str
        required: false

      autoflag_autocorr_powerspectra:
        desc: Flags antennas based on drifts in the scan average of the auto correlation spectra per field. This doesn't strictly require any calibration. It is also not field structure dependent, since it is just based on the DC of the field. Compares scan to median power of scans per field per channel. Also compares antenna to median of the array per scan per field per channel. This should catch any antenna with severe temperature problems.
        type: map
        mapping:
          enable:
            desc: Enables flagging of antennas based on drifts in the scan average of the auto correlation spectra per field.
            type: bool
            required: false
          scan_to_scan_threshold:
            desc: Threshold for flagging in sigma above the rest of the scans per field per channel.
            type: int
            required: false
          antenna_to_group_threshold: 
            desc: Threshold for flagging in sigma above array median power spectra per scan per field per channel.
            type: int
            required: false
          column:
            desc: Data column to flag.
            type: str
            required: false
          fields:
            desc: Fields to flag. Given as 'auto' or comma-seperated keys (keys in gcal, bpcal, target).
            type: str
            required: false
          calibrator_fields: 
            desc: Calibrator fields. Given as 'auto' or comma-seperated keys (keys in gcal, bpcal).
            type: str
            required: false
          threads: 
            desc: Number of threads to use.
            type: int
            required: false

      flag_autocorr:
        desc: Flag autocorrelations. Through CASA flagdata task.
        type: map
        mapping:
          enable:
            desc: Enables flagging of autocorrelations.
            type: bool
            required: false

      quack_flagging:
        desc: Do quack flagging, i.e. flag the begining and/or end chunks of each scan. Again, through FLAGDATA.
        type: map
        mapping:
          enable:
            desc: Enable quack flagging.
            type: bool
            required: false
          quackinterval:
            desc: Time interval (in seconds) to flag. 
            type: float
            required: false
          quackmode: 
            desc: Quack flagging mode. Either 'beg', which flags scan begining, 'endb', which flags end of the scan, 'end', which flags everything but the first specified seconds of the scan and 'tail' which flags all but the last specified seconds of the scan. 
            type: str
            enum: ["beg", "endb", "end", "tail"]
            required: false

      flag_spw: 
        desc: Flag spectral windows/channels. Of course, through FLAGDATA.
        type: map
        mapping: 
          enable:
            desc: Enable flagging spectral windows/ channels.
            type: bool
            required: false
          channels: 
            desc: Channels to flag. Given as "spectral window index:start channel ~ end channel", e.g. "*:856~880MHz". End channel not inclusive.
            type: str
            required: false

      flag_time: 
        desc: Flag timerange in the data using CASA FLAGDATA task.
        type: map
        mapping: 
          enable: 
            desc: Enable flagging timeranges.
            type: bool
            required: false
          timerange: 
            desc: Timerange to flag. Given in format 'YYYY/MM/DD/HH:MM:SS-YYYY/MM/DD/HH:MM:SS'.
            type: str
            required: false

      flag_antennas:
        desc: Flag bad antennas. Or just the ones you have sworn a vendetta against.
        type: map
        mapping:
          enable: 
            desc: Enables flagging of bad antennas. 
            type: bool
            required: false
          antennas:
            desc: Antennas to flag. Follows the CASA Flagdata syntax. 
            type: str
            required: false

      flag_scan:
        desc: Flag bad scans. Uses CASA Flagdata task.
        type: map
        mapping: 
          enable:
            desc: Enables flagging of bad scans. 
            type: bool
            required: false
          scans: 
            desc: Scans to flag. CASA flagdata syntax.
            type: str
            required: false

      static_mask:
        desc: Apply static mask to flag out known RFI, Meerkat specific. 
        type: map
        mapping: 
          enable:
            desc: Enables the application of static mask on the data.
            type: bool
            required: false
          mask: 
            desc: The mask to apply. 
            type: str
            required: false
          uvrange:
            desc: UV range to select (CASA style range, e.g. lower~upper) for flagging. Leave blank for entire array.
            type: str
            required: false

      autoflag_rfi:
        desc: Flag RFI using AOFlagger software. 
        type: map
        mapping:   
          enable: 
            desc: Enable RFI flagging with AOFlagger.
            type: bool
            required: false
          strategy: 
            desc: The AOFlagger strategy file to use.
            type: str
            required: false

      flagging_summary:
        desc: Write flagging summary at the end of the pre-calibration flagging. Uses CASA FLAGDATA in "summary" mode.
        type: map
        mapping:
          enable:
            desc: Enables the writing of flagging summary.
            type: bool
            required: false 
