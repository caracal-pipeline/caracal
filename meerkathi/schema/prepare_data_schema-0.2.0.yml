type: map
mapping:
  schema_version:
    type: str
    required: true

  prepare_data:
    desc: Prepare the data for calibration and imaging.
    type: map
    mapping:
      enable:
        desc: Executes the data preparation step.
        type: bool
        required: true
        example: 'False'
      fixvis:
        desc: Fixes the UVW coordinates through the CASA task fixvis.
        type: map
        mapping:
          enable:
            desc: Enable execution of fixvis.
            type: bool
            required: false
            example: 'False'            
      clear_cal:
        desc: Clears out calibrated data and resets previous predicted model
        type: bool
        required: false
        example: 'False'            
      manage_flags:
        desc: Manage MS flags
        type: map
        mapping:
          enable: 
            desc: enable this section
            type: bool
            required: false
            example: 'true'
          add_bitflag_column:
            desc: Add BITFLAG and BITFLAG_ROW columns
            type: bool
            required: false
            example: 'true'
          init_legacy_flagset:
            desc: Save all current flags in a legacy flagset if it does not exist
            type: bool
            required: false
            example: 'true'
          remove_flagsets:
            desc: Remove all existing flagsets, except legacy flags
            type: bool
            required: false
            example: 'true'
      spectral_weights: 
        desc: How to initialize spectral weights
        type: map
        mapping: 
          enable: 
            desc: Enable this segment
            type: bool
            required: false
            example: 'False'
          mode:
            desc: "uniform: Set all weights to unity, estimate: Estimate spectral weights from frequency-dependent SEFD/Tsys/Noise values, delete: Delete WEIGHT_SPECTRUM column if it exists. if 'estimate', then further settings are available in the 'estimate' segement of this section"
            type: str
            enum: [uniform, estimate, delete]
            required: false
            example: uniform
          estimate:
            desc: Estimate spectral weights from frequency-dependent SEFD/Tsys/Noise values
            type: map
            mapping:
              stats_data: 
                desc: File with SEFD/Tsys/Noise data. If data is from MeerKAT telescope, you can specify 'use_package_meerkat_spec' to use package data.
                type: str
                example: 'use_package_meerkat_spec'
                required: false
              weight_columns:
                seq:
                  - type: str
                desc: column names
                required: false
                example: 'WEIGHT, WEIGHT_SPECTRUM'
              noise_columns:
                seq:
                  - type: str
                desc: column names for noise
                required: false
                example: 'SIGMA, SIGMA_SPECTRUM'
              write_to_ms:
                desc: write columns to file
                type: bool
                required: false
                example: 'True'
