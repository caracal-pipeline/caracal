<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>MeerKATHI Configuration Editor</title>
		<script src="javascript/js-yaml/dist/js-yaml.js"></script>
		<script src="javascript/model_parameterfile.js"></script>
		<script src="javascript/viewer_consoleviewer.js"></script>
		<script src="javascript/viewer_outline.js"></script>
		<link rel="stylesheet" href="css/default.css">
		<script type="text/javascript">
			if (!(window.File && window.FileReader && window.FileList && window.Blob)) {
				alert('The File APIs are not fully supported in this browser.');
			}
            function getParameterByName(name, url = null) {
                /*
                 * Ref https://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript  
                 */
                if (!url) url = window.location.href;
                name = name.replace(/[\[\]]/g, "\\$&");
                var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                    results = regex.exec(url);
                if (!results) return null;
                if (!results[2]) return '';
                return decodeURIComponent(results[2].replace(/\+/g, " "));
            }
            function b64DecodeUnicode(str) {
                // Going backwards: from bytestream, to percent-encoding, to original string.
                return decodeURIComponent(atob(str).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                        }).join(''));
            }
		</script>
	</head>
	<body>
		<div id="div_filebrowse">
			<form id="frm_filebrowse">
				<input type="file" class="browser" value="atob(getQueryVariable(\"file\"))" id="ofd_yamlbrowser" onchange="on_load_file(this);" />
			</form>
		</div>
		<script>
			var paramfile = new parameter_file();
			var adebuglog = new console_viewer();
			var oview = new outline_viewer();
			paramfile.register_viewer(adebuglog);
			paramfile.register_viewer(oview);
            var cfgtxt = getParameterByName("filetxt");
            if (!cfgtxt) {
                alert("Configuration file text should be passsed in as querystring base64 encoded and labelled \"filetxt\"");
            } else {
                try{
                    console.log(cfgtxt);
                    paramfile.load(cfgtxt);
                } catch (err) {
                    alert("Failed to decode filetxt querystring argument. Is it Base64 encoded?\n"+err.message);
                }
            }
			function on_load_file(e){
				var file, fr;
				if (!e.files[0]) {
					alert("Please select a file");
				} else {
					paramfile.load(e.files[0]);
				}
				return false;
			}
		</script>
	</body>
</html>
